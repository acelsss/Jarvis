# Risk Approval Contract v0.1

## 概述

风险审批契约定义了风险评估和审批流程。

## 风险等级

- `R0`: 无风险，只读/纯生成，无副作用（可自动执行）
- `R1`: 低风险，低风险副作用（写入 sandbox、新建文件）（自动执行 + 必须审计）
- `R2`: 中风险，需要审批（运行未知代码、安装依赖、修改配置）
- `R3`: 高风险，需要审批（删除/覆盖、对外发布、涉及账号/支付/密钥、生产环境）

## 审批规则

- **R0 和 R1**：自动执行，无需审批
- **R2 和 R3**：需要审批后才能执行
- 审批通过后，任务状态从 `waiting_approval` 转为 `approved`，然后可以进入 `running` 状态

## 审批流程

1. 任务创建时评估风险（基于工具风险等级和计划步骤风险等级）
2. 如果计划包含 R2 或 R3 风险等级，任务进入 `waiting_approval` 状态
3. 审批通过后，任务状态转为 `approved`
4. 所有审批记录存储到审计日志

## 风险评估

风险评估基于：
- 工具的风险等级（`Tool.risk_level`）
- 计划步骤的风险等级（`PlanStep.risk_level`）
- 取计划中最高风险等级作为整体计划风险等级

## v0.1 实现

- 基于工具风险等级的简单评估
- 审批门控机制（`ApprovalGate`）
- 审批记录存储（`Approval` dataclass）

## 向后兼容说明

**注意**：旧版本文档中可能出现的风险等级名称（如 `low`、`medium`、`high`）已废弃。请以代码契约 `core/contracts/risk.py` 中定义的风险等级（R0-R3）为准。
